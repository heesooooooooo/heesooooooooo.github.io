<!DOCTYPE html>
<html>
<head https://www.w3.org/2005/10/howto-favicon>
  <link rel="icon" type="image/png" href="http://example.com/myicon.png">

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>[Android] 코루틴(Coroutine) 정리</title>
    <meta name="description" content="PS & 개발 기록" />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/blog/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://localhost:4000/blog//android-coroutine01" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/blog/page2/" />

    <meta property="og:site_name" content="...Developing..." />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="[Android] 코루틴(Coroutine) 정리" />
    <meta property="og:description" content="PS & 개발 기록" />
    <meta property="og:url" content="http://localhost:4000/blog//android-coroutine01" />
    <meta property="og:image" content="/blog/assets/images/cover4.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[Android] 코루틴(Coroutine) 정리" />
    <meta name="twitter:description" content="PS & 개발 기록" />
    <meta name="twitter:url" content="http://localhost:4000/blog//android-coroutine01" />
    <meta name="twitter:image:src" content="/blog/assets/images/cover4.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "...Developing...",
    "name": "[Android] 코루틴(Coroutine) 정리",
    "url": "http://localhost:4000/blog//android-coroutine01",
    "image": "/blog/assets/images/cover4.jpg",
    "description": "PS & 개발 기록"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="...Developing..." href="/blog/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
      <!-- home, boj, etc-->
        <li class="nav-home " role="presentation"><a href="/blog/">Home</a></li>
        <li class="nav-tags " role="presentation"><a href="/blog/tags">Tag</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/blog/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/blog/assets/images/cover4.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/blog/"><img src="/blog/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post android">

        <header class="post-header">
            <h1 class="post-title">[Android] 코루틴(Coroutine) 정리</h1>
            <section class="post-meta">
            <!-- <a href='/blog/'></a> -->

            
                
                    <a href='/blog/author/heesoo'>HEESOO</a>
                
            
                
            
                
            
                
            
                
            
                
            
            <time class="post-date" datetime="2021-03-10">10 Mar 2021</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/blog/tag/android'>Android</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>코루틴의 핵심은 <em>light-weight thread</em>이다.</p>

<h3 id="globalscope">GlobalScope</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">kotlinx.coroutines.*</span> 
<span class="n">fun</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span> 
    <span class="n">GlobalScope</span><span class="o">.</span><span class="na">launch</span> <span class="o">{</span> <span class="c1">// launch new coroutine in background and continue </span>
        <span class="n">delay</span><span class="o">(</span><span class="mi">1000L</span><span class="o">)</span> <span class="c1">// non-blocking delay for 1 second (default time unit is ms) </span>
        <span class="n">println</span><span class="o">(</span><span class="s">"World!"</span><span class="o">)</span> <span class="c1">// print after delay </span>
    <span class="o">}</span> 
    <span class="n">println</span><span class="o">(</span><span class="s">"Hello,"</span><span class="o">)</span> <span class="c1">// main thread continues while coroutine is delayed </span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000L</span><span class="o">)</span> <span class="c1">// block main thread for 2 seconds to keep JVM alive </span>
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li>위 예제는 GlobalScope에서 코루틴을 실행한 모습이다.</li>
  <li>launch는 coroutine의 Builder이며, 이를 이용해서 코드를 coroutineScope안에서 실행시킨다.</li>
  <li>GlobalScope의 lifetime은 전체 application process에 의존하므로, application이 종료되면 같이 끝나기 때문에, 끝에서 sleep을 걸고 기다려야 launch 내부 동작을 실행할 수 있다.</li>
  <li>안드로이드에서는 sleep을 걸지 않아도 “Hello, World!”가 출력된다. Activity를 finish()하더라도 process 자체가 죽지 않기 때문에, sleep이 없어도 coroutine 내부 코드는 그대로 실행된다. 하지만 저가형 단말에서는 메모리 문제로 finish()와 함께 process가 kill될 수도 있기 때문에 반드시 coroutine 동작이 유지된다고 판단할 수도 없다.</li>
  <li>delay는 thread를 차단하지 않으며, coroutine에서만 사용할 수 있다.</li>
</ul>

<h3 id="runblocking">runBlocking</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="n">fun</span> <span class="nf">test2</span><span class="o">()</span> <span class="o">{</span> 
    <span class="n">runBlocking</span><span class="o">&lt;</span><span class="n">Unit</span><span class="o">&gt;</span> <span class="o">{</span> 
        <span class="n">launch</span> <span class="o">{</span> 
            <span class="n">delay</span><span class="o">(</span><span class="mi">1000L</span><span class="o">)</span> 
            <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"World"</span><span class="o">)</span> 
        <span class="o">}</span> 
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"Hello"</span><span class="o">)</span> 
        <span class="n">delay</span><span class="o">(</span><span class="mi">2000L</span><span class="o">)</span> 
    <span class="o">}</span> 
    <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">"End function"</span><span class="o">)</span> 
<span class="o">}</span></pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li>runBlocking을 만나면 main thread는 내부 코드가 완료될 때까지 block된다.</li>
  <li>Hello \n World \ End function 순으로 찍힌다.</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="n">GlobalScope</span><span class="o">.</span><span class="na">launch</span> <span class="o">{</span> <span class="c1">// launch new coroutine in background and continue</span>
    <span class="n">delay</span><span class="o">(</span><span class="mi">1000L</span><span class="o">)</span> <span class="c1">// non-blocking delay for 1 second (default time unit is ms)</span>
    <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"sequence"</span><span class="o">,</span><span class="s">"4"</span><span class="o">)</span> <span class="c1">// print after delay</span>
<span class="o">}</span>

<span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"sequence"</span><span class="o">,</span><span class="s">"1"</span><span class="o">)</span>

<span class="n">runBlocking</span> <span class="o">{</span> <span class="c1">// but this expression blocks the main thread</span>
    <span class="n">delay</span><span class="o">(</span><span class="mi">4000L</span><span class="o">)</span> <span class="c1">// ... while we delay for 2 seconds to keep JVM alive</span>
    <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"sequence"</span><span class="o">,</span><span class="s">"3"</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"sequence"</span><span class="o">,</span><span class="s">"2"</span><span class="o">)</span></pre></td></tr></tbody></table></code></pre></figure>

<ul>
  <li>위 코드는 1 4 3 2 순으로 찍힌다.</li>
  <li><em>GlobalScope의 delay는 main thread를 막지 않고, runBlocking은 막는다</em></li>
</ul>

<h3 id="join">join()</h3>
<ul>
  <li>다른 코루틴이 작동하는 동안 delay하는 것은 좋지 않은 방법이다.</li>
  <li>백그라운드 작업이 완료될 때까지 join()을 사용하여 명시적으로 기다려야 한다.</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="n">fun</span> <span class="nf">main</span><span class="o">()</span> <span class="o">=</span> <span class="n">runBlocking</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">job</span> <span class="o">=</span> <span class="n">GlobalScope</span><span class="o">.</span><span class="na">launch</span> <span class="o">{</span> <span class="c1">// launch new coroutine and keep a reference to its Job</span>
    <span class="n">delay</span><span class="o">(</span><span class="mi">1000L</span><span class="o">)</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"World!"</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"Hello,"</span><span class="o">)</span>
    <span class="n">job</span><span class="o">.</span><span class="na">join</span><span class="o">()</span> <span class="c1">// wait until child coroutine completes</span>
<span class="o">}</span>

<span class="o">-</span> </pre></td></tr></tbody></table></code></pre></figure>

<h5 id="참고">참고</h5>
<ul>
  <li>[Kotlin] 코틀린 - 코루틴#1 기본! <a href="https://tourspace.tistory.com/150">https://tourspace.tistory.com/150</a></li>
  <li>안드로이드 Kotlin Coroutines 정리 Part 1 <a href="https://eso0609.tistory.com/73">https://eso0609.tistory.com/73</a></li>
</ul>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/blog/author/heesoo" style="background-image: url(/blog/assets/images/casper.png)"><span class="hidden">heesoo's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/blog/author/heesoo">HEESOO</a></h4>

                        
                            <p> Hello</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> South Korea</span>
                            <span class="author-link icon-link"><a href="http://iamheesoo.github.io/blog/"> iamheesoo.github.io/blog</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=[Android] 코루틴(Coroutine) 정리&amp;url=http://localhost:4000android-coroutine01"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000android-coroutine01"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:4000android-coroutine01"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            
                
            
                
            
                
            
                
            
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/blog/assets/images/cover4.jpg)" href="/blog/temp">
            <section class="post">
                <h2>temp</h2>
                <p>temp123</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/blog/assets/images/cover4.jpg)" href="/blog/android-aac01">
            <section class="post">
                <h2>[Android] AAC(Android Architecture Components) 정리</h2>
                <p>AAC 테스트와 유지보수가 쉬운 앱을 디자인할 수 있도록 돕는 라이브러리의 모음이다. 안드로이드 앱을 만들면서 만날...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/blog/">...Developing...</a> &copy; 2021</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', '', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/blog/assets/js/index.js"></script>

</body>
</html>
